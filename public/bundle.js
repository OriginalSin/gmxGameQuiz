var app=function(){"use strict";function t(){}function e(t,e){for(var s in e)t[s]=e[s];return t}function s(t,e){for(var s in e)t[s]=1;return t}function n(t){t()}function i(t,e){t.appendChild(e)}function r(t,e,s){t.insertBefore(e,s)}function o(t){t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function u(){return document.createComment("")}function c(t,e){t.data=""+e}function h(){return Object.create(null)}function p(t){t._lock=!0,d(t._beforecreate),d(t._oncreate),d(t._aftercreate),t._lock=!1}function m(t,e){t._handlers=h(),t._slots=h(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function d(t){for(;t&&t.length;)t.shift()()}var f={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var s=t in this._handlers&&this._handlers[t].slice();if(s)for(var n=0;n<s.length;n+=1){var i=s[n];if(!i.__calling)try{i.__calling=!0,i.call(this,e)}finally{i.__calling=!1}}},on:function(t,e){var s=this._handlers[t]||(this._handlers[t]=[]);return s.push(e),{cancel:function(){var t=s.indexOf(e);~t&&s.splice(t,1)}}},set:function(t){this._set(e({},t)),this.root._lock||p(this.root)},_recompute:t,_set:function(t){var s=this._state,n={},i=!1;for(var r in t=e(this._staged,t),this._staged={},t)this._differs(t[r],s[r])&&(n[r]=i=!0);i&&(this._state=e(e({},s),t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:s}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:s})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};window.serverBase;var _={styleHook(t){let{question:e}=this.get();return e&&this.polyline&&t.id===e.id?{}:null},setLayerGame(t){let e=this.gmxMap.layersByID[t]||this.gmxMap.layers[Math.floor(this.gmxMap.layers.length*Math.random())];if(e){let t=e.getDataManager(),s=e.getGmxProperties(),n=s.MetaProperties,i=n.count?Number(n.count.Value):10,r=s.name,o=t.addObserver({type:"resend",layerID:r,callback:function(t){t.count&&(this.set({questions:t.added.sort(Math.random).slice(0,i)}),o.deactivate())}.bind(this)});e.setStyleHook(this.styleHook.bind(this)),this.map.addLayer(e);let a=localStorage.getItem("_gameQuiz_"),l=a?JSON.parse(a):{};this.set({layerGame:e,score:l})}},showQuestionResult(t){this.polyline&&this.map.removeLayer(this.polyline);let{question:e}=this.get(),s=e.dataOption.bounds.toLatLngBounds(!0),n=s.getCenter(),i=s.contains(this._latlng),r=L.polyline([n,this._latlng],{color:"red"}).addTo(this.map);this.map.fitBounds(r.getBounds());let o=r.toGeoJSON().geometry;this.polyline=r,this.setPopupContent(o,i)},nextQuestion(){this.map.closePopup(),this.map.removeLayer(this.polyline),this.polyline=null,this.root.nextQuestion(this.sc)},setPopupContent(t,e){let s=L.DomUtil.create("div",""),n=L.DomUtil.create("div","",s),i=L.DomUtil.create("button","",s);if(t){L.gmxUtil.geoJSONGetLength(t);let s=L.gmxUtil.getGeoJSONSummary(t),r=0;e?(r=10,n.innerHTML="Отлично вам начислено: <b>"+r+"</b> баллов"):n.innerHTML="Растояние от центра объекта:<br><b>"+s+"</b>",this.sc=r,i.innerHTML="Следующий вопрос",L.DomEvent.on(i,"click",this.nextQuestion,this)}else n.innerHTML="Я считаю что это здесь!",i.innerHTML="Показать",L.DomEvent.on(i,"click",this.showQuestionResult,this);this.popup.setContent(s),this.popupContent=s},clickMap(t){this.map.closePopup(),this._latlng=t.latlng,this.popup=L.popup().setLatLng(this._latlng),this.setPopupContent(),this.map.openPopup(this.popup)},createMap(t){let e=t.state||{},s=t.mapID||"A557835E1B2344479C092FBB0158B529",n=t.layerID||"",i=(t.apiKey,e.map?e.map.position:{});var r=L.tileLayer("//tilessputnik.ru/{z}/{x}/{y}.png",{maxZoom:18});let o=new L.Map("map",{layers:[r],center:new L.LatLng(i.y||26,i.x||83),zoom:i.z||7}).on("click",this.clickMap.bind(this),this);o.gmxControlsManager.init(),L.gmx.loadMap(s,{leafletMap:o}).then(function(t){t.layers.forEach(function(t){o.removeLayer(t)}),this.gmxMap=t,this.setLayerGame(n)}.bind(this)),this.map=o}};function g({changed:t,current:e,previous:s}){t.urlParams&&e.urlParams}function v({changed:t,current:e,previous:s}){}function y(i){var l,u;m(this,i),this._state=e({layerGame:null,questions:null,permalink:null,map:null},i.data),this._intro=!!i.intro,this._handlers.state=[g],this._handlers.update=[v],g.call(this,{changed:s({},this._state),current:this._state}),this._fragment=(this._state,{c(){(l=a("div")).id="map"},m(t,e){r(t,l,e),u=!0},p:t,i(t,e){u||this.m(t,e)},o:n,d(t){t&&o(l)}}),this.root._oncreate.push(()=>{(function(){let{urlParams:t}=this.get();this.createMap(t)}).call(this),this.fire("update",{changed:s({},this._state),current:this._state})}),i.target&&(this._fragment.c(),this._mount(i.target,i.anchor),p(this)),this._intro=!0}e(y.prototype,f),e(y.prototype,_);window.serverBase;var q={nextQuestion(t){let{questions:e,props:s,score:n}=this.get(),i=e.shift();if(this.sc=this.sc||0,this.sc+=t||0,!i){n=n||{};let t=s.name,e=n[t]||[];e.push(this.sc),n[t]=e,window.localStorage.setItem("_gameQuiz_",JSON.stringify(n))}this.set({questions:e,question:i})}};function b(t,e){var s,n,u,h=e.it;return{c(){s=a("li"),n=l(h),u=l(" баллов")},m(t,e){r(t,s,e),i(s,n),i(s,u)},p(t,e){(t.score||t.props)&&h!==(h=e.it)&&c(n,h)},d(t){t&&o(s)}}}function G(t,e){for(var s,n=e.score[e.props.name],i=[],l=0;l<n.length;l+=1)i[l]=b(0,k(e,n,l));return{c(){s=a("ul");for(var t=0;t<i.length;t+=1)i[t].c()},m(t,e){r(t,s,e);for(var n=0;n<i.length;n+=1)i[n].m(s,null)},p(t,e){if(t.score||t.props){n=e.score[e.props.name];for(var r=0;r<n.length;r+=1){const o=k(e,n,r);i[r]?i[r].p(t,o):(i[r]=b(0,o),i[r].c(),i[r].m(s,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=n.length}},d(t){t&&o(s),function(t,e){for(var s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}(i,t)}}}function M(e,s){var n;return{c(){(n=a("div")).innerHTML='<div class="svelte-11yhcgu"></div><div class="svelte-11yhcgu"></div><div class="svelte-11yhcgu"></div><div class="svelte-11yhcgu"></div>',n.className="lds-ellipsis svelte-11yhcgu"},m(t,e){r(t,n,e)},p:t,d(t){t&&o(n)}}}function x(t,e){var s,n,h,p,m,d,f,_,g,v=e.props.title,y=e.props.description;function q(e){t.nextQuestion()}var L=e.score[e.props.name]&&G(0,e);return{c(){var t,e;s=a("h1"),n=l(v),h=l("\r\n\t\t"),p=a("p"),m=l(y),d=l("\r\n\t\t"),(f=a("button")).textContent="Начать",_=l("\r\n\t\t"),L&&L.c(),g=u(),s.className="title",p.className="description",t="click",e=q,f.addEventListener(t,e,!1),f.className="start"},m(t,e){r(t,s,e),i(s,n),r(t,h,e),r(t,p,e),i(p,m),r(t,d,e),r(t,f,e),r(t,_,e),L&&L.m(t,e),r(t,g,e)},p(t,e){t.props&&v!==(v=e.props.title)&&c(n,v),t.props&&y!==(y=e.props.description)&&c(m,y),e.score[e.props.name]?L?L.p(t,e):((L=G(0,e)).c(),L.m(g.parentNode,g)):L&&(L.d(1),L=null)},d(t){var e,n;t&&(o(s),o(h),o(p),o(d),o(f)),e="click",n=q,f.removeEventListener(e,n,!1),t&&o(_),L&&L.d(t),t&&o(g)}}}function P(t,e){var s,n,u=e.question?e.question.properties[1]:"";return{c(){s=a("div"),n=l(u),s.className="question svelte-11yhcgu"},m(t,e){r(t,s,e),i(s,n)},p(t,e){t.question&&u!==(u=e.question?e.question.properties[1]:"")&&c(n,u)},d(t){t&&o(s)}}}function N(t,e){var s,n,i;function u(t){return t.layerGame?x:M}var c=u(e),h=c(t,e);return{c(){s=a("div"),n=l("\r\n\t"),i=a("div"),h.c(),s.className="scrim svelte-11yhcgu",i.className="controls svelte-11yhcgu"},m(t,e){r(t,s,e),r(t,n,e),r(t,i,e),h.m(i,null)},p(e,s){c===(c=u(s))&&h?h.p(e,s):(h.d(1),(h=c(t,s)).c(),h.m(i,null))},d(t){t&&(o(s),o(n),o(i)),h.d()}}}function k(t,e,s){const n=Object.create(t);return n.it=e[s],n.each_value=e,n.it_index=s,n}function w(t){m(this,t),this._state=e({urlParams:{},props:{},score:null},t.data),this._recompute({layerGame:1},this._state),this._intro=!!t.intro,this._fragment=function(t,e){var s,n,i,a={},c={urlParams:e.urlParams};void 0!==e.layerGame&&(c.layerGame=e.layerGame,a.layerGame=!0),void 0!==e.score&&(c.score=e.score,a.score=!0),void 0!==e.questions&&(c.questions=e.questions,a.questions=!0),void 0!==e.question&&(c.question=e.question,a.question=!0);var h=new y({root:t.root,store:t.store,data:c,_bind(e,s){var n={};!a.layerGame&&e.layerGame&&(n.layerGame=s.layerGame),!a.score&&e.score&&(n.score=s.score),!a.questions&&e.questions&&(n.questions=s.questions),!a.question&&e.question&&(n.question=s.question),t._set(n),a={}}});function p(t){return t.question?P:N}t.root._beforecreate.push(()=>{h._bind({layerGame:1,score:1,questions:1,question:1},h.get())});var m=p(e),d=m(t,e);return{c(){h._fragment.c(),s=l("\r\n"),d.c(),n=u()},m(t,e){h._mount(t,e),r(t,s,e),d.m(t,e),r(t,n,e),i=!0},p(s,i){e=i;var r={};s.urlParams&&(r.urlParams=e.urlParams),!a.layerGame&&s.layerGame&&(r.layerGame=e.layerGame,a.layerGame=void 0!==e.layerGame),!a.score&&s.score&&(r.score=e.score,a.score=void 0!==e.score),!a.questions&&s.questions&&(r.questions=e.questions,a.questions=void 0!==e.questions),!a.question&&s.question&&(r.question=e.question,a.question=void 0!==e.question),h._set(r),a={},m===(m=p(e))&&d?d.p(s,e):(d.d(1),(d=m(t,e)).c(),d.m(n.parentNode,n))},i(t,e){i||this.m(t,e)},o(t){i&&(h&&h._fragment.o(t),i=!1)},d(t){h.destroy(t),t&&o(s),d.d(t),t&&o(n)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),p(this)),this._intro=!0}e(w.prototype,f),e(w.prototype,q),w.prototype._recompute=function(t,e){t.layerGame&&this._differs(e.props,e.props=function({layerGame:t}){return t?t.getGmxProperties():{}}(e))&&(t.props=!0)};let C=(()=>{let t={};return location.search.substr(1).split("&").forEach(e=>{let s=e.split("=");t[s[0]]=s[1]}),t})();return new w({target:document.body,data:{urlParams:C,name:"world"}})}();
//# sourceMappingURL=bundle.js.map
