var app=function(){"use strict";function t(){}function e(t,e){for(var s in e)t[s]=e[s];return t}function s(t,e){for(var s in e)t[s]=1;return t}function i(t){t()}function n(t,e){t.appendChild(e)}function r(t,e,s){t.insertBefore(e,s)}function o(t){t.parentNode.removeChild(t)}function a(t,e){for(var s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}function l(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function c(){return document.createComment("")}function p(t,e,s){t.addEventListener(e,s,!1)}function h(t,e,s){t.removeEventListener(e,s,!1)}function m(t,e,s){t.setAttribute(e,s)}function d(t,e){t.data=""+e}function f(){return Object.create(null)}function v(t){t._lock=!0,y(t._beforecreate),y(t._oncreate),y(t._aftercreate),t._lock=!1}function _(t,e){t._handlers=f(),t._slots=f(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function y(t){for(;t&&t.length;)t.shift()()}var g={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var s=t in this._handlers&&this._handlers[t].slice();if(s)for(var i=0;i<s.length;i+=1){var n=s[i];if(!n.__calling)try{n.__calling=!0,n.call(this,e)}finally{n.__calling=!1}}},on:function(t,e){var s=this._handlers[t]||(this._handlers[t]=[]);return s.push(e),{cancel:function(){var t=s.indexOf(e);~t&&s.splice(t,1)}}},set:function(t){this._set(e({},t)),this.root._lock||v(this.root)},_recompute:t,_set:function(t){var s=this._state,i={},n=!1;for(var r in t=e(this._staged,t),this._staged={},t)this._differs(t[r],s[r])&&(i[r]=n=!0);n&&(this._state=e(e({},s),t),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(this.fire("state",{changed:i,current:this._state,previous:s}),this._fragment.p(i,this._state),this.fire("update",{changed:i,current:this._state,previous:s})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};window.serverBase;var q={styleHook(t){let{question:e}=this.get();return e&&this.polyline&&t.id===e.id?{}:null},setLayerGame(t){let e=this.gmxMap.layersByID[t]||this.gmxMap.layers[Math.floor(this.gmxMap.layers.length*Math.random())];if(e){let t=e.getDataManager(),s=e.getGmxProperties(),i=s.MetaProperties,n=i.count?Number(i.count.Value):10,r=s.name,o=t.addObserver({type:"resend",layerID:r,callback:function(t){t.count&&(this.set({questions:t.added.sort(Math.random).slice(0,n)}),o.deactivate())}.bind(this)});e.setStyleHook(this.styleHook.bind(this)),this.map.addLayer(e);let a=localStorage.getItem("_gameQuiz_"),l=a?JSON.parse(a):{};this.set({layerGame:e,score:l})}},showQuestionResult(t){this.polyline&&this.map.removeLayer(this.polyline);let{question:e}=this.get(),s=e.dataOption.bounds.toLatLngBounds(!0),i=s.getCenter(),n=s.contains(this._latlng),r=L.polyline([i,this._latlng],{color:"red"}).addTo(this.map);this.map.fitBounds(r.getBounds());let o=r.toGeoJSON().geometry;this.polyline=r,this.setPopupContent(o,n)},nextQuestion(){this.map.closePopup(),this.map.removeLayer(this.polyline),this.polyline=null,this.root.nextQuestion(this.sc)},setPopupContent(t,e){let s=L.DomUtil.create("div",""),i=L.DomUtil.create("div","",s),n=L.DomUtil.create("button","",s);if(t){L.gmxUtil.geoJSONGetLength(t);let s=L.gmxUtil.getGeoJSONSummary(t),r={},o=0;e?(o=10,i.innerHTML="Отлично вам начислено: <b>"+o+"</b> баллов",r.ok=o+" баллов"):(i.innerHTML="Растояние от центра объекта:<br><b>"+s+"</b>",r.len=s),this.set({resultQuestion:r}),this.sc=o,n.innerHTML="Следующий вопрос",L.DomEvent.on(n,"click",this.nextQuestion,this)}else i.innerHTML="Я считаю что это здесь!",n.innerHTML="Показать",L.DomEvent.on(n,"click",this.showQuestionResult,this);this.popup.setContent(s),this.popupContent=s},clickMap(t){this.map.closePopup(),this._latlng=t.latlng,this.popup=L.popup().setLatLng(this._latlng),this.setPopupContent(),this.map.openPopup(this.popup)},setQuizList(){},createMap(t){let e=t.state||{},s=t.mapID||"A557835E1B2344479C092FBB0158B529",i=t.layerID||"",n=(t.apiKey,e.map?e.map.position:{});var r=L.tileLayer("//tilessputnik.ru/{z}/{x}/{y}.png",{maxZoom:18});let o=new L.Map("map",{layers:[r],center:new L.LatLng(n.y||26,n.x||83),zoom:n.z||7}).on("click",this.clickMap.bind(this),this);o.gmxControlsManager.init();let a=[];L.gmx.loadMap(s,{leafletMap:o}).then(function(t){t.layers.forEach(function(t){o.removeLayer(t);let e=t.getGmxProperties(),s=e.MetaProperties,i={};for(let t in s){let e=s[t].Value;i[t]=e>0?Number(e):e}a.push({gmxLayer:t,metaHash:i,title:e.title,layerID:e.name})}),this.quizList=a,this.gmxMap=t,i?this.setLayerGame(i):this.set({quizList:this.quizList})}.bind(this)),this.map=o}};function Q({changed:t,current:e,previous:s}){t.selectQuiz&&e.selectQuiz?(this.map.closePopup(),this.polyline&&(this.map.removeLayer(this.polyline),this.polyline=null),this.set({quizList:this.quizList})):t.layerID&&e.layerID&&this.setLayerGame(e.layerID)}function z(n){var a,u;_(this,n),this._state=e({layerGame:null,quizList:null,questions:null,permalink:null,map:null},n.data),this._intro=!!n.intro,this._handlers.state=[Q],Q.call(this,{changed:s({},this._state),current:this._state}),this._fragment=(this._state,{c(){(a=l("div")).id="map"},m(t,e){r(t,a,e),u=!0},p:t,i(t,e){u||this.m(t,e)},o:i,d(t){t&&o(a)}}),this.root._oncreate.push(()=>{(function(){let{urlParams:t}=this.get();this.createMap(t)}).call(this),this.fire("update",{changed:s({},this._state),current:this._state})}),n.target&&(this._fragment.c(),this._mount(n.target,n.anchor),v(this)),this._intro=!0}e(z.prototype,g),e(z.prototype,q);window.serverBase;var b={selectGame(){},nextQuestion(t){let{questions:e,props:s,score:i}=this.get(),n=e.shift();if(this.sc=this.sc||0,this.sc+=t||0,!n){i=i||{};let t=s.name,e=i[t]||[];e.push(this.sc),i[t]=e,window.localStorage.setItem("_gameQuiz_",JSON.stringify(i))}this.set({questions:e,question:n,resultQuestion:!1})}};function x({changed:t,current:e,previous:s}){}function D(t,e){var s,i,a,c,m,f,v,_,y,g=e.resultQuestion.len||"",q=e.resultQuestion.ok||"";function L(e){t.nextQuestion()}function Q(e){t.set({selectQuiz:!0,question:!1})}return{c(){s=l("div"),i=u("("),a=u(g),c=u(q),m=u(")"),f=u("\r\n\t\t\t"),(v=l("button")).textContent="Продолжить",_=u("\r\n\t\t\t"),(y=l("button")).textContent="Выбрать игру",s.className="question-result svelte-1amo6jq",p(v,"click",L),v.className="start",p(y,"click",Q),y.className="start"},m(t,e){r(t,s,e),n(s,i),n(s,a),n(s,c),n(s,m),r(t,f,e),r(t,v,e),r(t,_,e),r(t,y,e)},p(t,e){t.resultQuestion&&g!==(g=e.resultQuestion.len||"")&&d(a,g),t.resultQuestion&&q!==(q=e.resultQuestion.ok||"")&&d(c,q)},d(t){t&&(o(s),o(f),o(v)),h(v,"click",L),t&&(o(_),o(y)),h(y,"click",Q)}}}function G(t,e){var s,i,a=e.it.title;return{c(){s=l("li"),i=u(a),s._svelte={component:t,ctx:e},p(s,"click",O)},m(t,e){r(t,s,e),n(s,i)},p(t,n){e=n,t.quizList&&a!==(a=e.it.title)&&d(i,a),s._svelte.ctx=e},d(t){t&&o(s),h(s,"click",O)}}}function M(t,e){var s,i,a;return{c(){s=l("div"),(i=l("iframe")).title="video",i.width="100%",i.height="315",i.src=a=e.props.MetaProperties.video.Value,m(i,"frameborder","0"),m(i,"allow","autoplay; encrypted-media"),i.allowFullscreen=!0},m(t,e){r(t,s,e),n(s,i)},p(t,e){t.props&&a!==(a=e.props.MetaProperties.video.Value)&&(i.src=a)},d(t){t&&o(s)}}}function k(t,e){var s,i,a,c=e.it;return{c(){s=l("li"),i=u(c),a=u(" баллов")},m(t,e){r(t,s,e),n(s,i),n(s,a)},p(t,e){(t.score||t.props)&&c!==(c=e.it)&&d(i,c)},d(t){t&&o(s)}}}function I(t,e){for(var s,i=e.score[e.props.name],n=[],u=0;u<i.length;u+=1)n[u]=k(0,H(e,i,u));return{c(){s=l("ul");for(var t=0;t<n.length;t+=1)n[t].c()},m(t,e){r(t,s,e);for(var i=0;i<n.length;i+=1)n[i].m(s,null)},p(t,e){if(t.score||t.props){i=e.score[e.props.name];for(var r=0;r<i.length;r+=1){const o=H(e,i,r);n[r]?n[r].p(t,o):(n[r]=k(0,o),n[r].c(),n[r].m(s,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=i.length}},d(t){t&&o(s),a(n,t)}}}function P(t,e){for(var s,i,n,c=e.quizList,p=[],h=0;h<c.length;h+=1)p[h]=G(t,B(e,c,h));return{c(){(s=l("h1")).textContent="Выбрать игру",i=u("\r\n\t\t"),n=l("ul");for(var t=0;t<p.length;t+=1)p[t].c();s.className="title",n.className="selectQuiz svelte-1amo6jq"},m(t,e){r(t,s,e),r(t,i,e),r(t,n,e);for(var o=0;o<p.length;o+=1)p[o].m(n,null)},p(e,s){if(e.quizList){c=s.quizList;for(var i=0;i<c.length;i+=1){const r=B(s,c,i);p[i]?p[i].p(e,r):(p[i]=G(t,r),p[i].c(),p[i].m(n,null))}for(;i<p.length;i+=1)p[i].d(1);p.length=c.length}},d(t){t&&(o(s),o(i),o(n)),a(p,t)}}}function N(e,s){var i;return{c(){(i=l("div")).innerHTML='<div class="svelte-1amo6jq"></div><div class="svelte-1amo6jq"></div><div class="svelte-1amo6jq"></div><div class="svelte-1amo6jq"></div>',i.className="lds-ellipsis svelte-1amo6jq"},m(t,e){r(t,i,e)},p:t,d(t){t&&o(i)}}}function w(t,e){var s,i,a,m,f,v,_,y,g,q,L,Q,z=e.props.title,b=e.props.description;function x(e){t.nextQuestion()}function D(e){t.set({selectQuiz:!0})}var G=e.props.MetaProperties.video&&e.props.MetaProperties.video.Value&&M(0,e),k=e.score[e.props.name]&&I(0,e);return{c(){s=l("h1"),i=u(z),a=u("\r\n\t\t"),m=l("p"),f=u(b),v=u("\r\n\t\t"),(_=l("button")).textContent="Начать",y=u("\r\n\t\t"),(g=l("button")).textContent="Выбрать другую игру",q=u("\r\n\t\t"),G&&G.c(),L=u("\r\n\t\t"),k&&k.c(),Q=c(),s.className="title",m.className="description",p(_,"click",x),_.className="start",p(g,"click",D),g.className="start"},m(t,e){r(t,s,e),n(s,i),r(t,a,e),r(t,m,e),n(m,f),r(t,v,e),r(t,_,e),r(t,y,e),r(t,g,e),r(t,q,e),G&&G.m(t,e),r(t,L,e),k&&k.m(t,e),r(t,Q,e)},p(t,e){t.props&&z!==(z=e.props.title)&&d(i,z),t.props&&b!==(b=e.props.description)&&d(f,b),e.props.MetaProperties.video&&e.props.MetaProperties.video.Value?G?G.p(t,e):((G=M(0,e)).c(),G.m(L.parentNode,L)):G&&(G.d(1),G=null),e.score[e.props.name]?k?k.p(t,e):((k=I(0,e)).c(),k.m(Q.parentNode,Q)):k&&(k.d(1),k=null)},d(t){t&&(o(s),o(a),o(m),o(v),o(_)),h(_,"click",x),t&&(o(y),o(g)),h(g,"click",D),t&&o(q),G&&G.d(t),t&&o(L),k&&k.d(t),t&&o(Q)}}}function C(t,e){var s,i,a,c=e.question?e.question.properties[1]:"",p=e.resultQuestion&&D(t,e);return{c(){s=l("div"),i=u(c),a=u("\r\n\t\t"),p&&p.c(),s.className="question svelte-1amo6jq"},m(t,e){r(t,s,e),n(s,i),n(s,a),p&&p.m(s,null)},p(e,n){e.question&&c!==(c=n.question?n.question.properties[1]:"")&&d(i,c),n.resultQuestion?p?p.p(e,n):((p=D(t,n)).c(),p.m(s,null)):p&&(p.d(1),p=null)},d(t){t&&o(s),p&&p.d()}}}function j(t,e){var s,i,n;function a(t){return t.quizList?P:t.layerGame?w:N}var c=a(e),p=c(t,e);return{c(){s=l("div"),i=u("\r\n\t"),n=l("div"),p.c(),s.className="scrim svelte-1amo6jq",n.className="controls svelte-1amo6jq"},m(t,e){r(t,s,e),r(t,i,e),r(t,n,e),p.m(n,null)},p(e,s){c===(c=a(s))&&p?p.p(e,s):(p.d(1),(p=c(t,s)).c(),p.m(n,null))},d(t){t&&(o(s),o(i),o(n)),p.d()}}}function B(t,e,s){const i=Object.create(t);return i.it=e[s],i.each_value=e,i.it_index=s,i}function O(t){const{component:e,ctx:s}=this._svelte;e.set({layerID:s.it.layerID,selectQuiz:!1,quizList:!1})}function H(t,e,s){const i=Object.create(t);return i.it=e[s],i.each_value_1=e,i.it_index_1=s,i}function S(t){_(this,t),this._state=e({urlParams:{},quizList:null,selectQuiz:null,props:{},score:null},t.data),this._recompute({layerGame:1},this._state),this._intro=!!t.intro,this._handlers.state=[x],x.call(this,{changed:s({},this._state),current:this._state}),this._fragment=function(t,e){var s,i,n,a={},l={urlParams:e.urlParams};void 0!==e.selectQuiz&&(l.selectQuiz=e.selectQuiz,a.selectQuiz=!0),void 0!==e.quizList&&(l.quizList=e.quizList,a.quizList=!0),void 0!==e.layerID&&(l.layerID=e.layerID,a.layerID=!0),void 0!==e.layerGame&&(l.layerGame=e.layerGame,a.layerGame=!0),void 0!==e.score&&(l.score=e.score,a.score=!0),void 0!==e.questions&&(l.questions=e.questions,a.questions=!0),void 0!==e.question&&(l.question=e.question,a.question=!0),void 0!==e.resultQuestion&&(l.resultQuestion=e.resultQuestion,a.resultQuestion=!0);var p=new z({root:t.root,store:t.store,data:l,_bind(e,s){var i={};!a.selectQuiz&&e.selectQuiz&&(i.selectQuiz=s.selectQuiz),!a.quizList&&e.quizList&&(i.quizList=s.quizList),!a.layerID&&e.layerID&&(i.layerID=s.layerID),!a.layerGame&&e.layerGame&&(i.layerGame=s.layerGame),!a.score&&e.score&&(i.score=s.score),!a.questions&&e.questions&&(i.questions=s.questions),!a.question&&e.question&&(i.question=s.question),!a.resultQuestion&&e.resultQuestion&&(i.resultQuestion=s.resultQuestion),t._set(i),a={}}});function h(t){return t.question?C:j}t.root._beforecreate.push(()=>{p._bind({selectQuiz:1,quizList:1,layerID:1,layerGame:1,score:1,questions:1,question:1,resultQuestion:1},p.get())});var m=h(e),d=m(t,e);return{c(){p._fragment.c(),s=u("\r\n"),d.c(),i=c()},m(t,e){p._mount(t,e),r(t,s,e),d.m(t,e),r(t,i,e),n=!0},p(s,n){e=n;var r={};s.urlParams&&(r.urlParams=e.urlParams),!a.selectQuiz&&s.selectQuiz&&(r.selectQuiz=e.selectQuiz,a.selectQuiz=void 0!==e.selectQuiz),!a.quizList&&s.quizList&&(r.quizList=e.quizList,a.quizList=void 0!==e.quizList),!a.layerID&&s.layerID&&(r.layerID=e.layerID,a.layerID=void 0!==e.layerID),!a.layerGame&&s.layerGame&&(r.layerGame=e.layerGame,a.layerGame=void 0!==e.layerGame),!a.score&&s.score&&(r.score=e.score,a.score=void 0!==e.score),!a.questions&&s.questions&&(r.questions=e.questions,a.questions=void 0!==e.questions),!a.question&&s.question&&(r.question=e.question,a.question=void 0!==e.question),!a.resultQuestion&&s.resultQuestion&&(r.resultQuestion=e.resultQuestion,a.resultQuestion=void 0!==e.resultQuestion),p._set(r),a={},m===(m=h(e))&&d?d.p(s,e):(d.d(1),(d=m(t,e)).c(),d.m(i.parentNode,i))},i(t,e){n||this.m(t,e)},o(t){n&&(p&&p._fragment.o(t),n=!1)},d(t){p.destroy(t),t&&o(s),d.d(t),t&&o(i)}}}(this,this._state),this.root._oncreate.push(()=>{this.fire("update",{changed:s({},this._state),current:this._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),v(this)),this._intro=!0}e(S.prototype,g),e(S.prototype,b),S.prototype._recompute=function(t,e){t.layerGame&&this._differs(e.props,e.props=function({layerGame:t}){return t?t.getGmxProperties():{}}(e))&&(t.props=!0)};let E=(()=>{let t={};return location.search.substr(1).split("&").forEach(e=>{let s=e.split("=");t[s[0]]=s[1]}),t})();return new S({target:document.body,data:{urlParams:E,name:"world"}})}();
//# sourceMappingURL=bundle.js.map
