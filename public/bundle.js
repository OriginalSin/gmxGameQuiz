var app=function(){"use strict";function t(){}function e(t,e){for(var s in e)t[s]=e[s];return t}function s(t,e){for(var s in e)t[s]=1;return t}function i(t){t()}function r(t,e){t.appendChild(e)}function n(t,e,s){t.insertBefore(e,s)}function o(t){t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function l(t){return document.createTextNode(t)}function u(){return document.createComment("")}function c(t,e,s){t.setAttribute(e,s)}function p(t,e){t.data=""+e}function h(){return Object.create(null)}function m(t){t._lock=!0,f(t._beforecreate),f(t._oncreate),f(t._aftercreate),t._lock=!1}function d(t,e){t._handlers=h(),t._slots=h(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function f(t){for(;t&&t.length;)t.shift()()}var _={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var s=t in this._handlers&&this._handlers[t].slice();if(s)for(var i=0;i<s.length;i+=1){var r=s[i];if(!r.__calling)try{r.__calling=!0,r.call(this,e)}finally{r.__calling=!1}}},on:function(t,e){var s=this._handlers[t]||(this._handlers[t]=[]);return s.push(e),{cancel:function(){var t=s.indexOf(e);~t&&s.splice(t,1)}}},set:function(t){this._set(e({},t)),this.root._lock||m(this.root)},_recompute:t,_set:function(t){var s=this._state,i={},r=!1;for(var n in t=e(this._staged,t),this._staged={},t)this._differs(t[n],s[n])&&(i[n]=r=!0);r&&(this._state=e(e({},s),t),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(this.fire("state",{changed:i,current:this._state,previous:s}),this._fragment.p(i,this._state),this.fire("update",{changed:i,current:this._state,previous:s})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};window.serverBase;var v={styleHook(t){let{question:e}=this.get();return e&&this.polyline&&t.id===e.id?{}:null},setLayerGame(t){let e=this.gmxMap.layersByID[t]||this.gmxMap.layers[Math.floor(this.gmxMap.layers.length*Math.random())];if(e){let t=e.getDataManager(),s=e.getGmxProperties(),i=s.MetaProperties,r=i.count?Number(i.count.Value):10,n=s.name,o=t.addObserver({type:"resend",layerID:n,callback:function(t){t.count&&(this.set({questions:t.added.sort(Math.random).slice(0,r)}),o.deactivate())}.bind(this)});e.setStyleHook(this.styleHook.bind(this)),this.map.addLayer(e);let a=localStorage.getItem("_gameQuiz_"),l=a?JSON.parse(a):{};this.set({layerGame:e,score:l})}},showQuestionResult(t){this.polyline&&this.map.removeLayer(this.polyline);let{question:e}=this.get(),s=e.dataOption.bounds.toLatLngBounds(!0),i=s.getCenter(),r=s.contains(this._latlng),n=L.polyline([i,this._latlng],{color:"red"}).addTo(this.map);this.map.fitBounds(n.getBounds());let o=n.toGeoJSON().geometry;this.polyline=n,this.setPopupContent(o,r)},nextQuestion(){this.map.closePopup(),this.map.removeLayer(this.polyline),this.polyline=null,this.root.nextQuestion(this.sc)},setPopupContent(t,e){let s=L.DomUtil.create("div",""),i=L.DomUtil.create("div","",s),r=L.DomUtil.create("button","",s);if(t){L.gmxUtil.geoJSONGetLength(t);let s=L.gmxUtil.getGeoJSONSummary(t),n=0;e?(n=10,i.innerHTML="Отлично вам начислено: <b>"+n+"</b> баллов"):i.innerHTML="Растояние от центра объекта:<br><b>"+s+"</b>",this.sc=n,r.innerHTML="Следующий вопрос",L.DomEvent.on(r,"click",this.nextQuestion,this)}else i.innerHTML="Я считаю что это здесь!",r.innerHTML="Показать",L.DomEvent.on(r,"click",this.showQuestionResult,this);this.popup.setContent(s),this.popupContent=s},clickMap(t){this.map.closePopup(),this._latlng=t.latlng,this.popup=L.popup().setLatLng(this._latlng),this.setPopupContent(),this.map.openPopup(this.popup)},createMap(t){let e=t.state||{},s=t.mapID||"A557835E1B2344479C092FBB0158B529",i=t.layerID||"",r=(t.apiKey,e.map?e.map.position:{});var n=L.tileLayer("//tilessputnik.ru/{z}/{x}/{y}.png",{maxZoom:18});let o=new L.Map("map",{layers:[n],center:new L.LatLng(r.y||26,r.x||83),zoom:r.z||7}).on("click",this.clickMap.bind(this),this);o.gmxControlsManager.init(),L.gmx.loadMap(s,{leafletMap:o}).then(function(t){t.layers.forEach(function(t){o.removeLayer(t)}),this.gmxMap=t,this.setLayerGame(i)}.bind(this)),this.map=o}};function g({changed:t,current:e,previous:s}){t.urlParams&&e.urlParams}function y({changed:t,current:e,previous:s}){}function q(r){var l,u;d(this,r),this._state=e({layerGame:null,questions:null,permalink:null,map:null},r.data),this._intro=!!r.intro,this._handlers.state=[g],this._handlers.update=[y],g.call(this,{changed:s({},this._state),current:this._state}),this._fragment=(this._state,{c(){(l=a("div")).id="map"},m(t,e){n(t,l,e),u=!0},p:t,i(t,e){u||this.m(t,e)},o:i,d(t){t&&o(l)}}),this.root._oncreate.push(()=>{(function(){let{urlParams:t}=this.get();this.createMap(t)}).call(this),this.fire("update",{changed:s({},this._state),current:this._state})}),r.target&&(this._fragment.c(),this._mount(r.target,r.anchor),m(this)),this._intro=!0}e(q.prototype,_),e(q.prototype,v);window.serverBase;var b={nextQuestion(t){let{questions:e,props:s,score:i}=this.get(),r=e.shift();if(this.sc=this.sc||0,this.sc+=t||0,!r){i=i||{};let t=s.name,e=i[t]||[];e.push(this.sc),i[t]=e,window.localStorage.setItem("_gameQuiz_",JSON.stringify(i))}this.set({questions:e,question:r})}};function M(t,e){var s,i,l;return{c(){s=a("div"),(i=a("iframe")).title="video",i.width="100%",i.height="315",i.src=l=e.props.MetaProperties.video.Value,c(i,"frameborder","0"),c(i,"allow","autoplay; encrypted-media"),i.allowFullscreen=!0},m(t,e){n(t,s,e),r(s,i)},p(t,e){t.props&&l!==(l=e.props.MetaProperties.video.Value)&&(i.src=l)},d(t){t&&o(s)}}}function G(t,e){var s,i,u,c=e.it;return{c(){s=a("li"),i=l(c),u=l(" баллов")},m(t,e){n(t,s,e),r(s,i),r(s,u)},p(t,e){(t.score||t.props)&&c!==(c=e.it)&&p(i,c)},d(t){t&&o(s)}}}function P(t,e){for(var s,i=e.score[e.props.name],r=[],l=0;l<i.length;l+=1)r[l]=G(0,C(e,i,l));return{c(){s=a("ul");for(var t=0;t<r.length;t+=1)r[t].c()},m(t,e){n(t,s,e);for(var i=0;i<r.length;i+=1)r[i].m(s,null)},p(t,e){if(t.score||t.props){i=e.score[e.props.name];for(var n=0;n<i.length;n+=1){const o=C(e,i,n);r[n]?r[n].p(t,o):(r[n]=G(0,o),r[n].c(),r[n].m(s,null))}for(;n<r.length;n+=1)r[n].d(1);r.length=i.length}},d(t){t&&o(s),function(t,e){for(var s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}(r,t)}}}function x(e,s){var i;return{c(){(i=a("div")).innerHTML='<div class="svelte-11yhcgu"></div><div class="svelte-11yhcgu"></div><div class="svelte-11yhcgu"></div><div class="svelte-11yhcgu"></div>',i.className="lds-ellipsis svelte-11yhcgu"},m(t,e){n(t,i,e)},p:t,d(t){t&&o(i)}}}function N(t,e){var s,i,c,h,m,d,f,_,v,g,y=e.props.title,q=e.props.description;function L(e){t.nextQuestion()}var b=e.props.MetaProperties.video&&e.props.MetaProperties.video.Value&&M(0,e),G=e.score[e.props.name]&&P(0,e);return{c(){var t,e;s=a("h1"),i=l(y),c=l("\r\n\t\t"),h=a("p"),m=l(q),d=l("\r\n\t\t"),(f=a("button")).textContent="Начать",_=l("\r\n\t\t"),b&&b.c(),v=l("\r\n\t\t"),G&&G.c(),g=u(),s.className="title",h.className="description",t="click",e=L,f.addEventListener(t,e,!1),f.className="start"},m(t,e){n(t,s,e),r(s,i),n(t,c,e),n(t,h,e),r(h,m),n(t,d,e),n(t,f,e),n(t,_,e),b&&b.m(t,e),n(t,v,e),G&&G.m(t,e),n(t,g,e)},p(t,e){t.props&&y!==(y=e.props.title)&&p(i,y),t.props&&q!==(q=e.props.description)&&p(m,q),e.props.MetaProperties.video&&e.props.MetaProperties.video.Value?b?b.p(t,e):((b=M(0,e)).c(),b.m(v.parentNode,v)):b&&(b.d(1),b=null),e.score[e.props.name]?G?G.p(t,e):((G=P(0,e)).c(),G.m(g.parentNode,g)):G&&(G.d(1),G=null)},d(t){var e,i;t&&(o(s),o(c),o(h),o(d),o(f)),e="click",i=L,f.removeEventListener(e,i,!1),t&&o(_),b&&b.d(t),t&&o(v),G&&G.d(t),t&&o(g)}}}function k(t,e){var s,i,u=e.question?e.question.properties[1]:"";return{c(){s=a("div"),i=l(u),s.className="question svelte-11yhcgu"},m(t,e){n(t,s,e),r(s,i)},p(t,e){t.question&&u!==(u=e.question?e.question.properties[1]:"")&&p(i,u)},d(t){t&&o(s)}}}function w(t,e){var s,i,r;function u(t){return t.layerGame?N:x}var c=u(e),p=c(t,e);return{c(){s=a("div"),i=l("\r\n\t"),r=a("div"),p.c(),s.className="scrim svelte-11yhcgu",r.className="controls svelte-11yhcgu"},m(t,e){n(t,s,e),n(t,i,e),n(t,r,e),p.m(r,null)},p(e,s){c===(c=u(s))&&p?p.p(e,s):(p.d(1),(p=c(t,s)).c(),p.m(r,null))},d(t){t&&(o(s),o(i),o(r)),p.d()}}}function C(t,e,s){const i=Object.create(t);return i.it=e[s],i.each_value=e,i.it_index=s,i}function B(t){d(this,t),this._state=e({urlParams:{},props:{},score:null},t.data),this._recompute({layerGame:1},this._state),this._intro=!!t.intro,this._fragment=function(t,e){var s,i,r,a={},c={urlParams:e.urlParams};void 0!==e.layerGame&&(c.layerGame=e.layerGame,a.layerGame=!0),void 0!==e.score&&(c.score=e.score,a.score=!0),void 0!==e.questions&&(c.questions=e.questions,a.questions=!0),void 0!==e.question&&(c.question=e.question,a.question=!0);var p=new q({root:t.root,store:t.store,data:c,_bind(e,s){var i={};!a.layerGame&&e.layerGame&&(i.layerGame=s.layerGame),!a.score&&e.score&&(i.score=s.score),!a.questions&&e.questions&&(i.questions=s.questions),!a.question&&e.question&&(i.question=s.question),t._set(i),a={}}});function h(t){return t.question?k:w}t.root._beforecreate.push(()=>{p._bind({layerGame:1,score:1,questions:1,question:1},p.get())});var m=h(e),d=m(t,e);return{c(){p._fragment.c(),s=l("\r\n"),d.c(),i=u()},m(t,e){p._mount(t,e),n(t,s,e),d.m(t,e),n(t,i,e),r=!0},p(s,r){e=r;var n={};s.urlParams&&(n.urlParams=e.urlParams),!a.layerGame&&s.layerGame&&(n.layerGame=e.layerGame,a.layerGame=void 0!==e.layerGame),!a.score&&s.score&&(n.score=e.score,a.score=void 0!==e.score),!a.questions&&s.questions&&(n.questions=e.questions,a.questions=void 0!==e.questions),!a.question&&s.question&&(n.question=e.question,a.question=void 0!==e.question),p._set(n),a={},m===(m=h(e))&&d?d.p(s,e):(d.d(1),(d=m(t,e)).c(),d.m(i.parentNode,i))},i(t,e){r||this.m(t,e)},o(t){r&&(p&&p._fragment.o(t),r=!1)},d(t){p.destroy(t),t&&o(s),d.d(t),t&&o(i)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),m(this)),this._intro=!0}e(B.prototype,_),e(B.prototype,b),B.prototype._recompute=function(t,e){t.layerGame&&this._differs(e.props,e.props=function({layerGame:t}){return t?t.getGmxProperties():{}}(e))&&(t.props=!0)};let D=(()=>{let t={};return location.search.substr(1).split("&").forEach(e=>{let s=e.split("=");t[s[0]]=s[1]}),t})();return new B({target:document.body,data:{urlParams:D,name:"world"}})}();
//# sourceMappingURL=bundle.js.map
